{"ast":null,"code":"import { __assign, __rest, __spreadArray } from \"tslib\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useCallback, useImperativeHandle, useLayoutEffect, useMemo, useRef } from 'react';\nimport clsx from 'clsx';\nimport { getBaseProps } from '../internal/base-component';\nimport { fireNonCancelableEvent } from '../internal/events';\nimport { useStableEventHandler } from '../internal/hooks/use-stable-event-handler';\nimport InternalAttributeEditor from '../attribute-editor/internal';\nimport InternalStatusIndicator from '../status-indicator/internal';\nimport InternalBox from '../box/internal';\nimport { FormFieldError } from '../form-field/internal';\nimport { TagControl, UndoButton } from './internal';\nimport { validate } from './validation';\nimport { findIndex, useMemoizedArray } from './utils';\nimport styles from './styles.css.js';\nimport { applyDisplayName } from '../internal/utils/apply-display-name';\nimport useBaseComponent from '../internal/hooks/use-base-component';\nvar isItemRemovable = function (_a) {\n  var tag = _a.tag;\n  return !tag.markedForRemoval;\n};\nvar TagEditor = React.forwardRef(function (_a, ref) {\n  var _b, _c;\n  var _d = _a.tags,\n    tags = _d === void 0 ? [] : _d,\n    i18nStrings = _a.i18nStrings,\n    _e = _a.loading,\n    loading = _e === void 0 ? false : _e,\n    _f = _a.tagLimit,\n    tagLimit = _f === void 0 ? 50 : _f,\n    allowedCharacterPattern = _a.allowedCharacterPattern,\n    keysRequest = _a.keysRequest,\n    valuesRequest = _a.valuesRequest,\n    onChange = _a.onChange,\n    restProps = __rest(_a, [\"tags\", \"i18nStrings\", \"loading\", \"tagLimit\", \"allowedCharacterPattern\", \"keysRequest\", \"valuesRequest\", \"onChange\"]);\n  var baseComponentProps = useBaseComponent('TagEditor');\n  var remainingTags = tagLimit - tags.filter(function (tag) {\n    return !tag.markedForRemoval;\n  }).length;\n  var attributeEditorRef = useRef(null);\n  var keyInputRefs = useRef([]);\n  var valueInputRefs = useRef([]);\n  var undoButtonRefs = useRef([]);\n  var initialKeyOptionsRef = useRef([]);\n  var keyDirtyStateRef = useRef([]);\n  var focusEventRef = useRef();\n  useLayoutEffect(function () {\n    var _a;\n    (_a = focusEventRef.current) === null || _a === void 0 ? void 0 : _a.apply(undefined);\n    focusEventRef.current = undefined;\n  });\n  var errors = validate(tags, keyDirtyStateRef.current, i18nStrings, allowedCharacterPattern ? new RegExp(allowedCharacterPattern) : undefined);\n  var internalTags = useMemoizedArray(tags.map(function (tag, i) {\n    return {\n      tag: tag,\n      error: errors[i]\n    };\n  }), function (prev, next) {\n    var _a, _b, _c, _d;\n    return prev.tag === next.tag && ((_a = prev.error) === null || _a === void 0 ? void 0 : _a.key) === ((_b = next.error) === null || _b === void 0 ? void 0 : _b.key) && ((_c = prev.error) === null || _c === void 0 ? void 0 : _c.value) === ((_d = next.error) === null || _d === void 0 ? void 0 : _d.value);\n  });\n  useImperativeHandle(ref, function () {\n    return {\n      focus: function () {\n        var _a, _b;\n        var errorIndex = findIndex(internalTags, function (_a) {\n          var error = _a.error;\n          return (error === null || error === void 0 ? void 0 : error.key) || (error === null || error === void 0 ? void 0 : error.value);\n        });\n        if (errorIndex !== -1) {\n          var refArray = ((_a = internalTags[errorIndex].error) === null || _a === void 0 ? void 0 : _a.key) ? keyInputRefs : valueInputRefs;\n          (_b = refArray.current[errorIndex]) === null || _b === void 0 ? void 0 : _b.focus();\n        }\n      }\n    };\n  }, [internalTags]);\n  var validateAndFire = useCallback(function (newTags) {\n    fireNonCancelableEvent(onChange, {\n      tags: newTags,\n      valid: !validate(newTags, keyDirtyStateRef.current, i18nStrings, allowedCharacterPattern ? new RegExp(allowedCharacterPattern) : undefined).some(function (error) {\n        return error;\n      })\n    });\n  }, [onChange, i18nStrings, allowedCharacterPattern]);\n  var onAddButtonClick = function () {\n    validateAndFire(__spreadArray(__spreadArray([], tags, true), [{\n      key: '',\n      value: '',\n      existing: false\n    }], false));\n    focusEventRef.current = function () {\n      var _a;\n      (_a = keyInputRefs.current[tags.length]) === null || _a === void 0 ? void 0 : _a.focus();\n    };\n  };\n  var onRemoveButtonClick = useStableEventHandler(function (_a) {\n    var _b;\n    var detail = _a.detail;\n    var existing = tags[detail.itemIndex].existing;\n    validateAndFire(__spreadArray(__spreadArray(__spreadArray([], tags.slice(0, detail.itemIndex), true), existing ? [__assign(__assign({}, tags[detail.itemIndex]), {\n      markedForRemoval: true\n    })] : [], true), tags.slice(detail.itemIndex + 1), true));\n    if (existing) {\n      focusEventRef.current = function () {\n        var _a;\n        (_a = undoButtonRefs.current[detail.itemIndex]) === null || _a === void 0 ? void 0 : _a.focus();\n      };\n    } else {\n      keyDirtyStateRef.current.splice(detail.itemIndex, 1);\n      (_b = keyInputRefs.current[detail.itemIndex]) === null || _b === void 0 ? void 0 : _b.focus();\n    }\n  });\n  var onKeyChange = useStableEventHandler(function (value, row) {\n    keyDirtyStateRef.current[row] = true;\n    validateAndFire(__spreadArray(__spreadArray(__spreadArray([], tags.slice(0, row), true), [__assign(__assign({}, tags[row]), {\n      key: value\n    })], false), tags.slice(row + 1), true));\n  });\n  var onKeyBlur = useStableEventHandler(function (row) {\n    keyDirtyStateRef.current[row] = true;\n    // Force re-render by providing a new array reference\n    validateAndFire(__spreadArray([], tags, true));\n  });\n  var onValueChange = useStableEventHandler(function (value, row) {\n    validateAndFire(__spreadArray(__spreadArray(__spreadArray([], tags.slice(0, row), true), [__assign(__assign({}, tags[row]), {\n      value: value\n    })], false), tags.slice(row + 1), true));\n  });\n  var onUndoRemoval = useStableEventHandler(function (row) {\n    validateAndFire(__spreadArray(__spreadArray(__spreadArray([], tags.slice(0, row), true), [__assign(__assign({}, tags[row]), {\n      markedForRemoval: false\n    })], false), tags.slice(row + 1), true));\n    focusEventRef.current = function () {\n      var _a;\n      (_a = attributeEditorRef.current) === null || _a === void 0 ? void 0 : _a.focusRemoveButton(row);\n    };\n  });\n  var definition = useMemo(function () {\n    return [{\n      label: i18nStrings.keyHeader,\n      control: function (_a, row) {\n        var tag = _a.tag;\n        return React.createElement(TagControl, {\n          row: row,\n          value: tag.key,\n          readOnly: tag.existing,\n          limit: 200,\n          defaultOptions: [],\n          placeholder: i18nStrings.keyPlaceholder,\n          errorText: i18nStrings.keysSuggestionError,\n          loadingText: i18nStrings.keysSuggestionLoading,\n          suggestionText: i18nStrings.keySuggestion,\n          tooManySuggestionText: i18nStrings.tooManyKeysSuggestion,\n          enteredTextLabel: i18nStrings.enteredKeyLabel,\n          onRequest: keysRequest,\n          onChange: onKeyChange,\n          onBlur: onKeyBlur,\n          initialOptionsRef: initialKeyOptionsRef,\n          ref: function (ref) {\n            keyInputRefs.current[row] = ref;\n          }\n        });\n      },\n      errorText: function (_a) {\n        var error = _a.error;\n        return error === null || error === void 0 ? void 0 : error.key;\n      }\n    }, {\n      label: React.createElement(React.Fragment, null, i18nStrings.valueHeader, \" - \", React.createElement(\"i\", null, i18nStrings.optional)),\n      control: function (_a, row) {\n        var _b;\n        var tag = _a.tag;\n        return tag.markedForRemoval ? React.createElement(\"div\", {\n          role: \"alert\"\n        }, React.createElement(InternalBox, {\n          margin: {\n            top: 'xxs'\n          }\n        }, i18nStrings.undoPrompt, ' ', React.createElement(UndoButton, {\n          onClick: function () {\n            return onUndoRemoval(row);\n          },\n          ref: function (elem) {\n            undoButtonRefs.current[row] = elem;\n          }\n        }, i18nStrings.undoButton))) : React.createElement(TagControl, {\n          row: row,\n          value: tag.value,\n          readOnly: false,\n          limit: 200,\n          defaultOptions: (_b = tag.valueSuggestionOptions) !== null && _b !== void 0 ? _b : [],\n          placeholder: i18nStrings.valuePlaceholder,\n          errorText: i18nStrings.valuesSuggestionError,\n          loadingText: i18nStrings.valuesSuggestionLoading,\n          suggestionText: i18nStrings.valueSuggestion,\n          tooManySuggestionText: i18nStrings.tooManyValuesSuggestion,\n          enteredTextLabel: i18nStrings.enteredValueLabel,\n          filteringKey: tag.key,\n          onRequest: valuesRequest && function (value) {\n            return valuesRequest(tag.key, value);\n          },\n          onChange: onValueChange,\n          ref: function (ref) {\n            valueInputRefs.current[row] = ref;\n          }\n        });\n      },\n      errorText: function (_a) {\n        var error = _a.error;\n        return error === null || error === void 0 ? void 0 : error.value;\n      }\n    }];\n  }, [i18nStrings, keysRequest, onKeyChange, onKeyBlur, valuesRequest, onValueChange, onUndoRemoval]);\n  if (loading) {\n    return React.createElement(\"div\", {\n      className: styles.root,\n      ref: baseComponentProps.__internalRootRef\n    }, React.createElement(InternalStatusIndicator, {\n      className: styles.loading,\n      type: \"loading\"\n    }, i18nStrings.loading));\n  }\n  var baseProps = getBaseProps(restProps);\n  return React.createElement(InternalAttributeEditor, __assign({}, baseProps, baseComponentProps, {\n    ref: attributeEditorRef,\n    className: clsx(styles.root, baseProps.className),\n    items: internalTags,\n    isItemRemovable: isItemRemovable,\n    onAddButtonClick: onAddButtonClick,\n    onRemoveButtonClick: onRemoveButtonClick,\n    addButtonText: i18nStrings.addButton,\n    removeButtonText: i18nStrings.removeButton,\n    disableAddButton: remainingTags <= 0,\n    empty: i18nStrings.emptyTags,\n    additionalInfo: React.createElement(\"div\", {\n      \"aria-live\": \"polite\"\n    }, remainingTags < 0 ? React.createElement(FormFieldError, {\n      errorIconAriaLabel: i18nStrings.errorIconAriaLabel\n    }, (_b = i18nStrings.tagLimitExceeded(tagLimit)) !== null && _b !== void 0 ? _b : '') : remainingTags === 0 ? (_c = i18nStrings.tagLimitReached(tagLimit)) !== null && _c !== void 0 ? _c : '' : i18nStrings.tagLimit(remainingTags, tagLimit)),\n    definition: definition,\n    i18nStrings: i18nStrings\n  }));\n});\napplyDisplayName(TagEditor, 'TagEditor');\nexport default TagEditor;","map":{"version":3,"mappings":"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","names":["React","useCallback","useImperativeHandle","useLayoutEffect","useMemo","useRef","clsx","getBaseProps","fireNonCancelableEvent","useStableEventHandler","InternalAttributeEditor","InternalStatusIndicator","InternalBox","FormFieldError","TagControl","UndoButton","validate","findIndex","useMemoizedArray","styles","applyDisplayName","useBaseComponent","isItemRemovable","_a","tag","markedForRemoval","TagEditor","forwardRef","ref","tags","i18nStrings","_e","loading","_f","tagLimit","allowedCharacterPattern","keysRequest","valuesRequest","onChange","restProps","baseComponentProps","remainingTags","filter","length","attributeEditorRef","keyInputRefs","valueInputRefs","undoButtonRefs","initialKeyOptionsRef","keyDirtyStateRef","focusEventRef","current","apply","undefined","errors","RegExp","internalTags","map","i","error","prev","next","key","value","focus","errorIndex","refArray","validateAndFire","newTags","valid","some","onAddButtonClick","existing","onRemoveButtonClick","detail","itemIndex","slice","splice","onKeyChange","row","onKeyBlur","onValueChange","onUndoRemoval","focusRemoveButton","definition","label","keyHeader","control","readOnly","limit","defaultOptions","placeholder","keyPlaceholder","errorText","keysSuggestionError","loadingText","keysSuggestionLoading","suggestionText","keySuggestion","tooManySuggestionText","tooManyKeysSuggestion","enteredTextLabel","enteredKeyLabel","onRequest","onBlur","initialOptionsRef","valueHeader","optional","role","margin","top","undoPrompt","onClick","elem","undoButton","valueSuggestionOptions","valuePlaceholder","valuesSuggestionError","valuesSuggestionLoading","valueSuggestion","tooManyValuesSuggestion","enteredValueLabel","filteringKey","className","root","__internalRootRef","type","baseProps","items","addButtonText","addButton","removeButtonText","removeButton","disableAddButton","empty","emptyTags","additionalInfo","errorIconAriaLabel","tagLimitExceeded","tagLimitReached"],"sources":["/Users/dcastro/node_modules/src/tag-editor/index.tsx"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useCallback, useImperativeHandle, useLayoutEffect, useMemo, useRef } from 'react';\nimport clsx from 'clsx';\n\nimport { getBaseProps } from '../internal/base-component';\nimport { fireNonCancelableEvent, NonCancelableCustomEvent } from '../internal/events';\nimport { useStableEventHandler } from '../internal/hooks/use-stable-event-handler';\n\nimport { InputProps } from '../input/interfaces';\nimport { AutosuggestProps } from '../autosuggest/interfaces';\nimport { AttributeEditorProps } from '../attribute-editor/interfaces';\nimport InternalAttributeEditor from '../attribute-editor/internal';\nimport InternalStatusIndicator from '../status-indicator/internal';\nimport InternalBox from '../box/internal';\nimport { FormFieldError } from '../form-field/internal';\n\nimport { TagControl, UndoButton } from './internal';\nimport { TagEditorProps } from './interfaces';\nimport { validate, ValidationError } from './validation';\nimport { findIndex, useMemoizedArray } from './utils';\n\nimport styles from './styles.css.js';\nimport { applyDisplayName } from '../internal/utils/apply-display-name';\nimport useBaseComponent from '../internal/hooks/use-base-component';\n\nexport { TagEditorProps };\n\ninterface InternalTag {\n  tag: TagEditorProps.Tag;\n  error?: ValidationError;\n}\n\nconst isItemRemovable = ({ tag }: InternalTag) => !tag.markedForRemoval;\n\nconst TagEditor = React.forwardRef(\n  (\n    {\n      tags = [],\n      i18nStrings,\n      loading = false,\n      tagLimit = 50,\n      allowedCharacterPattern,\n      keysRequest,\n      valuesRequest,\n      onChange,\n      ...restProps\n    }: TagEditorProps,\n    ref: React.Ref<TagEditorProps.Ref>\n  ) => {\n    const baseComponentProps = useBaseComponent('TagEditor');\n\n    const remainingTags = tagLimit - tags.filter(tag => !tag.markedForRemoval).length;\n\n    const attributeEditorRef = useRef<AttributeEditorProps.Ref>(null);\n    const keyInputRefs = useRef<(InputProps.Ref | undefined | null)[]>([]);\n    const valueInputRefs = useRef<(InputProps.Ref | undefined | null)[]>([]);\n    const undoButtonRefs = useRef<(HTMLAnchorElement | undefined | null)[]>([]);\n\n    const initialKeyOptionsRef = useRef<AutosuggestProps.Options>([]);\n    const keyDirtyStateRef = useRef<boolean[]>([]);\n    const focusEventRef = useRef<() => void>();\n\n    useLayoutEffect(() => {\n      focusEventRef.current?.apply(undefined);\n      focusEventRef.current = undefined;\n    });\n\n    const errors = validate(\n      tags,\n      keyDirtyStateRef.current,\n      i18nStrings,\n      allowedCharacterPattern ? new RegExp(allowedCharacterPattern) : undefined\n    );\n\n    const internalTags = useMemoizedArray(\n      tags.map((tag, i) => ({ tag, error: errors[i] })),\n      (prev, next) => {\n        return prev.tag === next.tag && prev.error?.key === next.error?.key && prev.error?.value === next.error?.value;\n      }\n    );\n\n    useImperativeHandle(\n      ref,\n      () => ({\n        focus() {\n          const errorIndex = findIndex(internalTags, ({ error }) => error?.key || error?.value);\n          if (errorIndex !== -1) {\n            const refArray = internalTags[errorIndex].error?.key ? keyInputRefs : valueInputRefs;\n            refArray.current[errorIndex]?.focus();\n          }\n        },\n      }),\n      [internalTags]\n    );\n\n    const validateAndFire = useCallback(\n      (newTags: ReadonlyArray<TagEditorProps.Tag>) => {\n        fireNonCancelableEvent(onChange, {\n          tags: newTags,\n          valid: !validate(\n            newTags,\n            keyDirtyStateRef.current,\n            i18nStrings,\n            allowedCharacterPattern ? new RegExp(allowedCharacterPattern) : undefined\n          ).some(error => error),\n        });\n      },\n      [onChange, i18nStrings, allowedCharacterPattern]\n    );\n\n    const onAddButtonClick = () => {\n      validateAndFire([...tags, { key: '', value: '', existing: false }]);\n      focusEventRef.current = () => {\n        keyInputRefs.current[tags.length]?.focus();\n      };\n    };\n\n    const onRemoveButtonClick = useStableEventHandler(\n      ({ detail }: NonCancelableCustomEvent<AttributeEditorProps.RemoveButtonClickDetail>) => {\n        const existing = tags[detail.itemIndex].existing;\n        validateAndFire([\n          ...tags.slice(0, detail.itemIndex),\n          ...(existing ? [{ ...tags[detail.itemIndex], markedForRemoval: true }] : []),\n          ...tags.slice(detail.itemIndex + 1),\n        ]);\n        if (existing) {\n          focusEventRef.current = () => {\n            undoButtonRefs.current[detail.itemIndex]?.focus();\n          };\n        } else {\n          keyDirtyStateRef.current.splice(detail.itemIndex, 1);\n          keyInputRefs.current[detail.itemIndex]?.focus();\n        }\n      }\n    );\n\n    const onKeyChange = useStableEventHandler((value: string, row: number) => {\n      keyDirtyStateRef.current[row] = true;\n      validateAndFire([...tags.slice(0, row), { ...tags[row], key: value }, ...tags.slice(row + 1)]);\n    });\n\n    const onKeyBlur = useStableEventHandler((row: number) => {\n      keyDirtyStateRef.current[row] = true;\n      // Force re-render by providing a new array reference\n      validateAndFire([...tags]);\n    });\n\n    const onValueChange = useStableEventHandler((value: string, row: number) => {\n      validateAndFire([...tags.slice(0, row), { ...tags[row], value }, ...tags.slice(row + 1)]);\n    });\n\n    const onUndoRemoval = useStableEventHandler((row: number) => {\n      validateAndFire([...tags.slice(0, row), { ...tags[row], markedForRemoval: false }, ...tags.slice(row + 1)]);\n      focusEventRef.current = () => {\n        attributeEditorRef.current?.focusRemoveButton(row);\n      };\n    });\n\n    const definition = useMemo(\n      () => [\n        {\n          label: i18nStrings.keyHeader,\n          control: ({ tag }: InternalTag, row: number) => (\n            <TagControl\n              row={row}\n              value={tag.key}\n              readOnly={tag.existing}\n              limit={200}\n              defaultOptions={[]}\n              placeholder={i18nStrings.keyPlaceholder}\n              errorText={i18nStrings.keysSuggestionError}\n              loadingText={i18nStrings.keysSuggestionLoading}\n              suggestionText={i18nStrings.keySuggestion}\n              tooManySuggestionText={i18nStrings.tooManyKeysSuggestion}\n              enteredTextLabel={i18nStrings.enteredKeyLabel}\n              onRequest={keysRequest}\n              onChange={onKeyChange}\n              onBlur={onKeyBlur}\n              initialOptionsRef={initialKeyOptionsRef}\n              ref={ref => {\n                keyInputRefs.current[row] = ref;\n              }}\n            />\n          ),\n          errorText: ({ error }: InternalTag) => error?.key,\n        },\n        {\n          label: (\n            <>\n              {i18nStrings.valueHeader} - <i>{i18nStrings.optional}</i>\n            </>\n          ),\n          control: ({ tag }: InternalTag, row: number) =>\n            tag.markedForRemoval ? (\n              <div role=\"alert\">\n                <InternalBox margin={{ top: 'xxs' }}>\n                  {i18nStrings.undoPrompt}{' '}\n                  <UndoButton\n                    onClick={() => onUndoRemoval(row)}\n                    ref={elem => {\n                      undoButtonRefs.current[row] = elem;\n                    }}\n                  >\n                    {i18nStrings.undoButton}\n                  </UndoButton>\n                </InternalBox>\n              </div>\n            ) : (\n              <TagControl\n                row={row}\n                value={tag.value}\n                readOnly={false}\n                limit={200}\n                defaultOptions={tag.valueSuggestionOptions ?? []}\n                placeholder={i18nStrings.valuePlaceholder}\n                errorText={i18nStrings.valuesSuggestionError}\n                loadingText={i18nStrings.valuesSuggestionLoading}\n                suggestionText={i18nStrings.valueSuggestion}\n                tooManySuggestionText={i18nStrings.tooManyValuesSuggestion}\n                enteredTextLabel={i18nStrings.enteredValueLabel}\n                filteringKey={tag.key}\n                onRequest={valuesRequest && (value => valuesRequest(tag.key, value))}\n                onChange={onValueChange}\n                ref={ref => {\n                  valueInputRefs.current[row] = ref;\n                }}\n              />\n            ),\n          errorText: ({ error }: InternalTag) => error?.value,\n        },\n      ],\n      [i18nStrings, keysRequest, onKeyChange, onKeyBlur, valuesRequest, onValueChange, onUndoRemoval]\n    );\n\n    if (loading) {\n      return (\n        <div className={styles.root} ref={baseComponentProps.__internalRootRef}>\n          <InternalStatusIndicator className={styles.loading} type=\"loading\">\n            {i18nStrings.loading}\n          </InternalStatusIndicator>\n        </div>\n      );\n    }\n\n    const baseProps = getBaseProps(restProps);\n    return (\n      <InternalAttributeEditor<InternalTag>\n        {...baseProps}\n        {...baseComponentProps}\n        ref={attributeEditorRef}\n        className={clsx(styles.root, baseProps.className)}\n        items={internalTags}\n        isItemRemovable={isItemRemovable}\n        onAddButtonClick={onAddButtonClick}\n        onRemoveButtonClick={onRemoveButtonClick}\n        addButtonText={i18nStrings.addButton}\n        removeButtonText={i18nStrings.removeButton}\n        disableAddButton={remainingTags <= 0}\n        empty={i18nStrings.emptyTags}\n        additionalInfo={\n          <div aria-live=\"polite\">\n            {remainingTags < 0 ? (\n              <FormFieldError errorIconAriaLabel={i18nStrings.errorIconAriaLabel}>\n                {i18nStrings.tagLimitExceeded(tagLimit) ?? ''}\n              </FormFieldError>\n            ) : remainingTags === 0 ? (\n              i18nStrings.tagLimitReached(tagLimit) ?? ''\n            ) : (\n              i18nStrings.tagLimit(remainingTags, tagLimit)\n            )}\n          </div>\n        }\n        definition={definition}\n        i18nStrings={i18nStrings}\n      />\n    );\n  }\n);\n\napplyDisplayName(TagEditor, 'TagEditor');\nexport default TagEditor;\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}