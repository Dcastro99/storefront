{"ast":null,"code":"// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useLayoutEffect, useCallback } from 'react';\nimport { useResizeObserver } from '../internal/hooks/container-queries/use-resize-observer';\nimport stickyScrolling, { calculateScrollingOffset, scrollUpBy } from './sticky-scrolling';\nimport { useMobile } from '../internal/hooks/use-mobile';\nfunction syncSizes(from, to) {\n  var fromCells = Array.prototype.slice.apply(from.children);\n  var toCells = Array.prototype.slice.apply(to.children);\n  for (var i = 0; i < fromCells.length; i++) {\n    var width = fromCells[i].style.width;\n    // use auto if it is set by resizable columns or real size otherwise\n    if (width !== 'auto') {\n      width = \"\".concat(fromCells[i].offsetWidth, \"px\");\n    }\n    toCells[i].style.width = width;\n  }\n}\nexport var useStickyHeader = function (tableRef, theadRef, secondaryTheadRef, secondaryTableRef, tableWrapperRef) {\n  var isMobile = useMobile();\n  // Sync the sizes of the column header copies in the sticky header with the originals\n  var syncColumnHeaderWidths = useCallback(function () {\n    if (tableRef.current && theadRef.current && secondaryTheadRef.current && secondaryTableRef.current && tableWrapperRef.current) {\n      syncSizes(theadRef.current, secondaryTheadRef.current);\n      // Using the tableRef offsetWidth instead of the theadRef because in VR\n      // the tableRef adds extra padding to the table and by default the theadRef will have a width\n      // without the padding and will make the sticky header width incorrect.\n      secondaryTableRef.current.style.width = \"\".concat(tableRef.current.offsetWidth, \"px\");\n      tableWrapperRef.current.style.marginTop = \"-\".concat(theadRef.current.offsetHeight, \"px\");\n    }\n  }, [theadRef, secondaryTheadRef, secondaryTableRef, tableWrapperRef, tableRef]);\n  useLayoutEffect(function () {\n    syncColumnHeaderWidths();\n    // Content is not going to be layed out until the next frame in angular,\n    // so we need to sync the column headers again.\n    setTimeout(function () {\n      return syncColumnHeaderWidths();\n    }, 0);\n    var secondaryTable = secondaryTableRef.current;\n    var primaryTable = tableWrapperRef.current;\n    return function () {\n      if (secondaryTable) {\n        secondaryTable.style.width = '';\n      }\n      if (primaryTable) {\n        primaryTable.style.marginTop = '';\n      }\n    };\n  });\n  useResizeObserver(theadRef, syncColumnHeaderWidths);\n  var scrollToTop = function () {\n    if (!isMobile && theadRef.current && secondaryTheadRef.current && tableWrapperRef.current) {\n      var scrollDist = calculateScrollingOffset(theadRef.current, secondaryTheadRef.current);\n      if (scrollDist > 0) {\n        scrollUpBy(scrollDist, tableWrapperRef.current);\n      }\n    }\n  };\n  var scrollToItem = stickyScrolling(tableWrapperRef, secondaryTheadRef).scrollToItem;\n  var scrollToRow = function (itemNode) {\n    if (!isMobile) {\n      scrollToItem(itemNode);\n    }\n  };\n  return {\n    scrollToRow: scrollToRow,\n    scrollToTop: scrollToTop\n  };\n};","map":{"version":3,"mappings":"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","names":["useLayoutEffect","useCallback","useResizeObserver","stickyScrolling","calculateScrollingOffset","scrollUpBy","useMobile","syncSizes","from","to","fromCells","Array","prototype","slice","apply","children","toCells","i","length","width","style","offsetWidth","useStickyHeader","tableRef","theadRef","secondaryTheadRef","secondaryTableRef","tableWrapperRef","isMobile","syncColumnHeaderWidths","current","marginTop","offsetHeight","setTimeout","secondaryTable","primaryTable","scrollToTop","scrollDist","scrollToRow","itemNode","scrollToItem"],"sources":["/Users/dcastro/node_modules/src/table/use-sticky-header.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useLayoutEffect, RefObject, useCallback } from 'react';\nimport { useResizeObserver } from '../internal/hooks/container-queries/use-resize-observer';\nimport stickyScrolling, { calculateScrollingOffset, scrollUpBy } from './sticky-scrolling';\nimport { useMobile } from '../internal/hooks/use-mobile';\n\nfunction syncSizes(from: HTMLElement, to: HTMLElement) {\n  const fromCells = Array.prototype.slice.apply(from.children);\n  const toCells = Array.prototype.slice.apply(to.children);\n  for (let i = 0; i < fromCells.length; i++) {\n    let width = fromCells[i].style.width;\n    // use auto if it is set by resizable columns or real size otherwise\n    if (width !== 'auto') {\n      width = `${fromCells[i].offsetWidth}px`;\n    }\n    toCells[i].style.width = width;\n  }\n}\n\nexport const useStickyHeader = (\n  tableRef: RefObject<HTMLElement>,\n  theadRef: RefObject<HTMLElement>,\n  secondaryTheadRef: RefObject<HTMLElement>,\n  secondaryTableRef: RefObject<HTMLElement>,\n  tableWrapperRef: RefObject<HTMLElement>\n) => {\n  const isMobile = useMobile();\n  // Sync the sizes of the column header copies in the sticky header with the originals\n  const syncColumnHeaderWidths = useCallback(() => {\n    if (\n      tableRef.current &&\n      theadRef.current &&\n      secondaryTheadRef.current &&\n      secondaryTableRef.current &&\n      tableWrapperRef.current\n    ) {\n      syncSizes(theadRef.current, secondaryTheadRef.current);\n\n      // Using the tableRef offsetWidth instead of the theadRef because in VR\n      // the tableRef adds extra padding to the table and by default the theadRef will have a width\n      // without the padding and will make the sticky header width incorrect.\n      secondaryTableRef.current.style.width = `${tableRef.current.offsetWidth}px`;\n\n      tableWrapperRef.current.style.marginTop = `-${theadRef.current.offsetHeight}px`;\n    }\n  }, [theadRef, secondaryTheadRef, secondaryTableRef, tableWrapperRef, tableRef]);\n  useLayoutEffect(() => {\n    syncColumnHeaderWidths();\n    // Content is not going to be layed out until the next frame in angular,\n    // so we need to sync the column headers again.\n    setTimeout(() => syncColumnHeaderWidths(), 0);\n    const secondaryTable = secondaryTableRef.current;\n    const primaryTable = tableWrapperRef.current;\n    return () => {\n      if (secondaryTable) {\n        secondaryTable.style.width = '';\n      }\n      if (primaryTable) {\n        primaryTable.style.marginTop = '';\n      }\n    };\n  });\n  useResizeObserver(theadRef, syncColumnHeaderWidths);\n  const scrollToTop = () => {\n    if (!isMobile && theadRef.current && secondaryTheadRef.current && tableWrapperRef.current) {\n      const scrollDist = calculateScrollingOffset(theadRef.current, secondaryTheadRef.current);\n      if (scrollDist > 0) {\n        scrollUpBy(scrollDist, tableWrapperRef.current);\n      }\n    }\n  };\n  const { scrollToItem } = stickyScrolling(tableWrapperRef, secondaryTheadRef);\n  const scrollToRow = (itemNode: HTMLElement | null) => {\n    if (!isMobile) {\n      scrollToItem(itemNode);\n    }\n  };\n  return { scrollToRow, scrollToTop };\n};\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}