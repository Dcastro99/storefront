{"ast":null,"code":"// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useLayoutEffect, useMemo, useRef, useState } from 'react';\nimport clsx from 'clsx';\nimport { arc } from 'd3-shape';\nimport styles from './styles.css.js';\nimport { dimensionsBySize, balanceLabelNodes } from './utils';\nimport { useResizeObserver } from '../internal/hooks/container-queries';\nimport ResponsiveText from './responsive-text';\nfunction LabelElement(_a) {\n  var x = _a.x,\n    y = _a.y,\n    hideTitles = _a.hideTitles,\n    hideDescriptions = _a.hideDescriptions,\n    rightSide = _a.rightSide,\n    title = _a.title,\n    description = _a.description,\n    containerBoundaries = _a.containerBoundaries;\n  return (\n    // Reset the transform property to prepare for `balanceLabelNodes`.\n    // The dataset attributes are also needed in the function for IE11 support.\n    React.createElement(\"g\", {\n      className: styles['label-text'],\n      transform: \"\",\n      \"data-x\": x,\n      \"data-y\": y\n    }, !hideTitles && React.createElement(ResponsiveText, {\n      x: x,\n      y: y,\n      rightSide: rightSide,\n      containerBoundaries: containerBoundaries\n    }, title), !hideDescriptions && description && React.createElement(ResponsiveText, {\n      x: x,\n      y: y + (hideTitles ? 0 : 18),\n      rightSide: rightSide,\n      className: styles.label__description,\n      containerBoundaries: containerBoundaries\n    }, description))\n  );\n}\nexport default (function (_a) {\n  var pieData = _a.pieData,\n    size = _a.size,\n    highlightedSegment = _a.highlightedSegment,\n    segmentDescription = _a.segmentDescription,\n    visibleDataSum = _a.visibleDataSum,\n    hideTitles = _a.hideTitles,\n    hideDescriptions = _a.hideDescriptions,\n    containerRef = _a.containerRef;\n  var containerBoundaries = useElementBoundaries(containerRef);\n  var markers = useMemo(function () {\n    var _a = dimensionsBySize[size],\n      radius = _a.outerRadius,\n      innerLabelPadding = _a.innerLabelPadding;\n    // More arc factories for the label positioning\n    var arcMarkerStart = arc().innerRadius(radius - 1).outerRadius(radius - 1);\n    var arcMarkerBreak = arc().innerRadius(radius + innerLabelPadding).outerRadius(radius + innerLabelPadding);\n    return pieData.map(function (datum, i) {\n      var labelDatum = pieData[i];\n      var midAngle = labelDatum.startAngle + (labelDatum.endAngle - labelDatum.startAngle) / 2;\n      // Make the marker line longer if the segment is closer to the top or bottom of the chart\n      arcMarkerBreak.outerRadius(radius + 20 * (0.5 * Math.cos(2 * midAngle) + 0.5));\n      arcMarkerBreak.innerRadius(radius + 20 * (0.5 * Math.cos(2 * midAngle) + 0.5));\n      var _a = arcMarkerStart.centroid(datum),\n        startX = _a[0],\n        startY = _a[1];\n      var _b = arcMarkerBreak.centroid(datum),\n        breakX = _b[0],\n        breakY = _b[1];\n      var rightSide = midAngle < Math.PI;\n      var endX = (radius + 20) * (rightSide ? 1 : -1);\n      var textX = endX + 5 * (rightSide ? 1 : -1);\n      return {\n        startX: startX,\n        startY: startY,\n        breakX: breakX,\n        breakY: breakY,\n        endX: endX,\n        endY: breakY,\n        textX: textX,\n        textY: breakY,\n        rightSide: rightSide,\n        datum: datum\n      };\n    });\n  }, [pieData, size]);\n  var rootRef = useRef(null);\n  useLayoutEffect(function () {\n    if (!rootRef.current) {\n      return;\n    }\n    // Relax labels that are overlapping\n    var labelNodes = rootRef.current.querySelectorAll(\".\".concat(styles['label-text']));\n    balanceLabelNodes(labelNodes, markers, false);\n    balanceLabelNodes(labelNodes, markers, true);\n  }, [markers, pieData]);\n  return React.createElement(\"g\", {\n    className: styles.markers,\n    \"aria-hidden\": \"true\",\n    ref: rootRef\n  }, markers.map(function (_a) {\n    var _b;\n    var startX = _a.startX,\n      startY = _a.startY,\n      breakX = _a.breakX,\n      breakY = _a.breakY,\n      endX = _a.endX,\n      endY = _a.endY,\n      textX = _a.textX,\n      textY = _a.textY,\n      rightSide = _a.rightSide,\n      datum = _a.datum;\n    var segment = datum.data.datum;\n    var description = segmentDescription === null || segmentDescription === void 0 ? void 0 : segmentDescription(segment, visibleDataSum);\n    if (hideTitles && !description || hideDescriptions && !segment.title) {\n      return null;\n    }\n    return React.createElement(\"g\", {\n      key: datum.data.index,\n      className: clsx(styles.label, (_b = {}, _b[styles['label--highlighted']] = highlightedSegment === segment, _b[styles['label--dimmed']] = highlightedSegment !== null && highlightedSegment !== segment, _b[styles['label--align-right']] = !rightSide, _b))\n    }, React.createElement(\"line\", {\n      x1: startX,\n      y1: startY,\n      x2: breakX,\n      y2: breakY\n    }), React.createElement(\"line\", {\n      x1: breakX,\n      y1: breakY,\n      x2: endX,\n      y2: endY,\n      className: styles['label-line']\n    }), React.createElement(LabelElement, {\n      x: textX,\n      y: textY,\n      rightSide: rightSide,\n      title: segment.title,\n      description: description,\n      hideTitles: hideTitles,\n      hideDescriptions: hideDescriptions,\n      containerBoundaries: containerBoundaries\n    }));\n  }));\n});\nfunction useElementBoundaries(ref) {\n  var _a = useState({\n      left: 0,\n      right: 0\n    }),\n    state = _a[0],\n    setState = _a[1];\n  useResizeObserver(ref, function (entry) {\n    var elementRect = entry.target.getBoundingClientRect();\n    setState({\n      left: elementRect.left,\n      right: elementRect.right\n    });\n  });\n  return state;\n}","map":{"version":3,"mappings":"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","names":["React","useLayoutEffect","useMemo","useRef","useState","clsx","arc","styles","dimensionsBySize","balanceLabelNodes","useResizeObserver","ResponsiveText","LabelElement","_a","x","y","hideTitles","hideDescriptions","rightSide","title","description","containerBoundaries","className","transform","label__description","pieData","size","highlightedSegment","segmentDescription","visibleDataSum","containerRef","useElementBoundaries","markers","radius","innerLabelPadding","arcMarkerStart","innerRadius","outerRadius","arcMarkerBreak","map","datum","i","labelDatum","midAngle","startAngle","endAngle","Math","cos","centroid","startX","startY","breakX","breakY","PI","endX","textX","endY","textY","rootRef","current","labelNodes","querySelectorAll","ref","segment","data","key","index","label","_b","x1","y1","x2","y2","left","right","state","setState","elementRect","entry","target","getBoundingClientRect"],"sources":["/Users/dcastro/node_modules/src/pie-chart/labels.tsx"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useLayoutEffect, useMemo, useRef, useState } from 'react';\nimport clsx from 'clsx';\nimport { arc, PieArcDatum } from 'd3-shape';\n\nimport { PieChartProps } from './interfaces';\nimport styles from './styles.css.js';\nimport { InternalChartDatum } from './pie-chart';\nimport { dimensionsBySize, balanceLabelNodes } from './utils';\nimport { useResizeObserver } from '../internal/hooks/container-queries';\nimport ResponsiveText from './responsive-text';\n\nexport interface LabelsProps<T> {\n  pieData: PieArcDatum<InternalChartDatum<T>>[];\n  visibleDataSum: number;\n  size: NonNullable<PieChartProps['size']>;\n  hideTitles: boolean;\n  hideDescriptions: boolean;\n  highlightedSegment: PieChartProps.Datum | null;\n  segmentDescription?: PieChartProps.SegmentDescriptionFunction<T>;\n  containerRef: React.RefObject<HTMLDivElement>;\n}\n\ninterface LabelElementProps {\n  x: number;\n  y: number;\n  rightSide: boolean;\n  hideTitles: boolean;\n  hideDescriptions: boolean;\n  title: PieChartProps.Datum['title'];\n  description?: string;\n  containerBoundaries: null | { left: number; right: number };\n}\n\nfunction LabelElement({\n  x,\n  y,\n  hideTitles,\n  hideDescriptions,\n  rightSide,\n  title,\n  description,\n  containerBoundaries,\n}: LabelElementProps) {\n  return (\n    // Reset the transform property to prepare for `balanceLabelNodes`.\n    // The dataset attributes are also needed in the function for IE11 support.\n    <g className={styles['label-text']} transform=\"\" data-x={x} data-y={y}>\n      {!hideTitles && (\n        <ResponsiveText x={x} y={y} rightSide={rightSide} containerBoundaries={containerBoundaries}>\n          {title}\n        </ResponsiveText>\n      )}\n      {!hideDescriptions && description && (\n        <ResponsiveText\n          x={x}\n          y={y + (hideTitles ? 0 : 18)}\n          rightSide={rightSide}\n          className={styles.label__description}\n          containerBoundaries={containerBoundaries}\n        >\n          {description}\n        </ResponsiveText>\n      )}\n    </g>\n  );\n}\n\nexport default <T extends PieChartProps.Datum>({\n  pieData,\n  size,\n  highlightedSegment,\n  segmentDescription,\n  visibleDataSum,\n  hideTitles,\n  hideDescriptions,\n  containerRef,\n}: LabelsProps<T>) => {\n  const containerBoundaries = useElementBoundaries(containerRef);\n\n  const markers = useMemo(() => {\n    const { outerRadius: radius, innerLabelPadding } = dimensionsBySize[size];\n\n    // More arc factories for the label positioning\n    const arcMarkerStart = arc<PieArcDatum<any>>()\n      .innerRadius(radius - 1)\n      .outerRadius(radius - 1);\n\n    const arcMarkerBreak = arc<PieArcDatum<any>>()\n      .innerRadius(radius + innerLabelPadding)\n      .outerRadius(radius + innerLabelPadding);\n\n    return pieData.map((datum, i) => {\n      const labelDatum = pieData[i];\n      const midAngle = labelDatum.startAngle + (labelDatum.endAngle - labelDatum.startAngle) / 2;\n\n      // Make the marker line longer if the segment is closer to the top or bottom of the chart\n      arcMarkerBreak.outerRadius(radius + 20 * (0.5 * Math.cos(2 * midAngle) + 0.5));\n      arcMarkerBreak.innerRadius(radius + 20 * (0.5 * Math.cos(2 * midAngle) + 0.5));\n      const [startX, startY] = arcMarkerStart.centroid(datum);\n      const [breakX, breakY] = arcMarkerBreak.centroid(datum);\n\n      const rightSide = midAngle < Math.PI;\n      const endX = (radius + 20) * (rightSide ? 1 : -1);\n      const textX = endX + 5 * (rightSide ? 1 : -1);\n\n      return {\n        startX,\n        startY,\n        breakX,\n        breakY,\n        endX,\n        endY: breakY,\n        textX,\n        textY: breakY,\n        rightSide,\n        datum,\n      };\n    });\n  }, [pieData, size]);\n\n  const rootRef = useRef<SVGGElement>(null);\n\n  useLayoutEffect(() => {\n    if (!rootRef.current) {\n      return;\n    }\n\n    // Relax labels that are overlapping\n    const labelNodes = rootRef.current.querySelectorAll<SVGGElement>(`.${styles['label-text']}`);\n    balanceLabelNodes(labelNodes, markers, false);\n    balanceLabelNodes(labelNodes, markers, true);\n  }, [markers, pieData]);\n\n  return (\n    <g className={styles.markers} aria-hidden=\"true\" ref={rootRef}>\n      {markers.map(({ startX, startY, breakX, breakY, endX, endY, textX, textY, rightSide, datum }) => {\n        const segment = datum.data.datum;\n        const description = segmentDescription?.(segment, visibleDataSum);\n        if ((hideTitles && !description) || (hideDescriptions && !segment.title)) {\n          return null;\n        }\n        return (\n          <g\n            key={datum.data.index}\n            className={clsx(styles.label, {\n              [styles['label--highlighted']]: highlightedSegment === segment,\n              [styles['label--dimmed']]: highlightedSegment !== null && highlightedSegment !== segment,\n              [styles['label--align-right']]: !rightSide,\n            })}\n          >\n            <line x1={startX} y1={startY} x2={breakX} y2={breakY} />\n            <line x1={breakX} y1={breakY} x2={endX} y2={endY} className={styles['label-line']} />\n            <LabelElement\n              x={textX}\n              y={textY}\n              rightSide={rightSide}\n              title={segment.title}\n              description={description}\n              hideTitles={hideTitles}\n              hideDescriptions={hideDescriptions}\n              containerBoundaries={containerBoundaries}\n            />\n          </g>\n        );\n      })}\n    </g>\n  );\n};\n\nfunction useElementBoundaries(ref: React.RefObject<HTMLElement>): { left: number; right: number } {\n  const [state, setState] = useState({ left: 0, right: 0 });\n  useResizeObserver(ref, entry => {\n    const elementRect = entry.target.getBoundingClientRect();\n    setState({ left: elementRect.left, right: elementRect.right });\n  });\n  return state;\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}