{"ast":null,"code":"// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useEffect, useState } from 'react';\nimport { unstable_batchedUpdates } from 'react-dom';\nexport function createSingletonHandler(factory) {\n  var listeners = [];\n  var callback = function (value) {\n    unstable_batchedUpdates(function () {\n      for (var _i = 0, listeners_1 = listeners; _i < listeners_1.length; _i++) {\n        var listener = listeners_1[_i];\n        listener(value);\n      }\n    });\n  };\n  var cleanup;\n  return function useSingleton(listener) {\n    useEffect(function () {\n      if (listeners.length === 0) {\n        cleanup = factory(callback);\n      }\n      listeners.push(listener);\n      return function () {\n        listeners.splice(listeners.indexOf(listener), 1);\n        if (listeners.length === 0) {\n          cleanup();\n          cleanup = undefined;\n        }\n      };\n      // register handlers only on mount\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n  };\n}\nexport function createSingletonState(_a) {\n  var factory = _a.factory,\n    initialState = _a.initialState;\n  var useSingleton = createSingletonHandler(factory);\n  var value = initialState;\n  return function useSingletonState() {\n    var _a = useState(value),\n      state = _a[0],\n      setState = _a[1];\n    useSingleton(function (newValue) {\n      value = newValue;\n      setState(newValue);\n    });\n    return state;\n  };\n}","map":{"version":3,"mappings":"AAAA;AACA;AACA,SAASA,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAC3C,SAASC,uBAAuB,QAAQ,WAAW;AAMnD,OAAM,SAAUC,sBAAsB,CAAIC,OAAuD;EAC/F,IAAMC,SAAS,GAA4B,EAAE;EAC7C,IAAMC,QAAQ,GAAqB,eAAK;IACtCJ,uBAAuB,CAAC;MACtB,KAAuB,UAAS,EAATK,uBAAS,EAATC,uBAAS,EAATA,IAAS,EAAE;QAA7B,IAAMC,QAAQ;QACjBA,QAAQ,CAACC,KAAK,CAAC;;IAEnB,CAAC,CAAC;EACJ,CAAC;EACD,IAAIC,OAAiC;EAErC,OAAO,SAASC,YAAY,CAACH,QAA0B;IACrDT,SAAS,CAAC;MACR,IAAIK,SAAS,CAACQ,MAAM,KAAK,CAAC,EAAE;QAC1BF,OAAO,GAAGP,OAAO,CAACE,QAAQ,CAAC;;MAE7BD,SAAS,CAACS,IAAI,CAACL,QAAQ,CAAC;MAExB,OAAO;QACLJ,SAAS,CAACU,MAAM,CAACV,SAAS,CAACW,OAAO,CAACP,QAAQ,CAAC,EAAE,CAAC,CAAC;QAChD,IAAIJ,SAAS,CAACQ,MAAM,KAAK,CAAC,EAAE;UAC1BF,OAAQ,EAAE;UACVA,OAAO,GAAGM,SAAS;;MAEvB,CAAC;MACD;MACA;IACF,CAAC,EAAE,EAAE,CAAC;EACR,CAAC;AACH;AAOA,OAAM,SAAUC,oBAAoB,CAAIC,EAAmD;MAAjDf,OAAO;IAAEgB,YAAY;EAC7D,IAAMR,YAAY,GAAGT,sBAAsB,CAACC,OAAO,CAAC;EACpD,IAAIM,KAAK,GAAGU,YAAY;EACxB,OAAO,SAASC,iBAAiB;IACzB,SAAoBpB,QAAQ,CAAIS,KAAK,CAAC;MAArCY,KAAK;MAAEC,QAAQ,QAAsB;IAC5CX,YAAY,CAAC,kBAAQ;MACnBF,KAAK,GAAGc,QAAQ;MAChBD,QAAQ,CAACC,QAAQ,CAAC;IACpB,CAAC,CAAC;IACF,OAAOF,KAAK;EACd,CAAC;AACH","names":["useEffect","useState","unstable_batchedUpdates","createSingletonHandler","factory","listeners","callback","listeners_1","_i","listener","value","cleanup","useSingleton","length","push","splice","indexOf","undefined","createSingletonState","_a","initialState","useSingletonState","state","setState","newValue"],"sources":["/Users/dcastro/node_modules/src/internal/hooks/use-singleton-handler/index.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useEffect, useState } from 'react';\nimport { unstable_batchedUpdates } from 'react-dom';\n\ntype ValueCallback<T> = (value: T) => void;\ntype CleanupCallback = () => void;\nexport type UseSingleton<T> = (listener: ValueCallback<T>) => void;\n\nexport function createSingletonHandler<T>(factory: (handler: ValueCallback<T>) => CleanupCallback): UseSingleton<T> {\n  const listeners: Array<ValueCallback<T>> = [];\n  const callback: ValueCallback<T> = value => {\n    unstable_batchedUpdates(() => {\n      for (const listener of listeners) {\n        listener(value);\n      }\n    });\n  };\n  let cleanup: (() => void) | undefined;\n\n  return function useSingleton(listener: ValueCallback<T>) {\n    useEffect(() => {\n      if (listeners.length === 0) {\n        cleanup = factory(callback);\n      }\n      listeners.push(listener);\n\n      return () => {\n        listeners.splice(listeners.indexOf(listener), 1);\n        if (listeners.length === 0) {\n          cleanup!();\n          cleanup = undefined;\n        }\n      };\n      // register handlers only on mount\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n  };\n}\n\ninterface SingletonStateOptions<T> {\n  factory: (handler: ValueCallback<T>) => CleanupCallback;\n  initialState: T | (() => T); // useState signature\n}\n\nexport function createSingletonState<T>({ factory, initialState }: SingletonStateOptions<T>) {\n  const useSingleton = createSingletonHandler(factory);\n  let value = initialState;\n  return function useSingletonState() {\n    const [state, setState] = useState<T>(value);\n    useSingleton(newValue => {\n      value = newValue;\n      setState(newValue);\n    });\n    return state;\n  };\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}