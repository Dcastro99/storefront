{"ast":null,"code":"import { __assign } from \"tslib\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useEffect, useRef, useState } from 'react';\nimport InternalAutosuggest from '../autosuggest/internal';\nimport useFocusVisible from '../internal/hooks/focus-visible';\nimport { KeyCode } from '../internal/keycode';\nimport { makeCancellable, PromiseCancelledSignal } from '../internal/utils/promises';\nimport styles from './styles.css.js';\nexport var TagControl = React.forwardRef(function (_a, ref) {\n  var row = _a.row,\n    value = _a.value,\n    readOnly = _a.readOnly,\n    defaultOptions = _a.defaultOptions,\n    placeholder = _a.placeholder,\n    errorText = _a.errorText,\n    loadingText = _a.loadingText,\n    suggestionText = _a.suggestionText,\n    tooManySuggestionText = _a.tooManySuggestionText,\n    limit = _a.limit,\n    filteringKey = _a.filteringKey,\n    enteredTextLabel = _a.enteredTextLabel,\n    onChange = _a.onChange,\n    onBlur = _a.onBlur,\n    onRequest = _a.onRequest,\n    initialOptionsRef = _a.initialOptionsRef;\n  var _b = useState(defaultOptions),\n    options = _b[0],\n    setOptions = _b[1];\n  var _c = useState(),\n    statusType = _c[0],\n    setStatusType = _c[1];\n  var requestCancelFnRef = useRef({\n    cancel: function () {},\n    isCancelled: function () {\n      return false;\n    }\n  });\n  var latestFilteringQuery = useRef({\n    key: undefined,\n    value: undefined\n  });\n  var isSameQuery = function (key, value) {\n    return latestFilteringQuery.current.key === key && latestFilteringQuery.current.value === value;\n  };\n  // Cancel any active promises on unmount.\n  useEffect(function () {\n    return function () {\n      return requestCancelFnRef.current.cancel();\n    };\n  }, []);\n  var onLoadItems = function (filteringText) {\n    if (!onRequest || isSameQuery(filteringKey, filteringText) || requestCancelFnRef.current.isCancelled()) {\n      return;\n    }\n    requestCancelFnRef.current.cancel();\n    if (filteringText === '' && (initialOptionsRef === null || initialOptionsRef === void 0 ? void 0 : initialOptionsRef.current) && initialOptionsRef.current.length > 0) {\n      // Load in the background, if the value is empty and we already have suggestions.\n      setOptions(initialOptionsRef.current);\n    }\n    if (latestFilteringQuery.current.key !== filteringKey) {\n      setOptions([]);\n    }\n    setStatusType('loading');\n    latestFilteringQuery.current = {\n      key: filteringKey,\n      value: filteringText\n    };\n    var _a = makeCancellable(onRequest(filteringText)),\n      promise = _a.promise,\n      cancel = _a.cancel,\n      isCancelled = _a.isCancelled;\n    promise.then(function (newValues) {\n      var newOptions = newValues.map(function (value) {\n        return {\n          value: value\n        };\n      });\n      setStatusType(undefined);\n      setOptions(newOptions);\n      if (initialOptionsRef) {\n        initialOptionsRef.current = newOptions;\n      }\n    })[\"catch\"](function (err) {\n      if (!(err instanceof PromiseCancelledSignal)) {\n        setStatusType('error');\n      }\n    });\n    requestCancelFnRef.current = {\n      cancel: cancel,\n      isCancelled: isCancelled\n    };\n  };\n  return React.createElement(InternalAutosuggest, {\n    ref: ref,\n    value: value,\n    readOnly: readOnly,\n    statusType: statusType,\n    options: options.length < limit ? options : [],\n    empty: options.length < limit ? suggestionText : tooManySuggestionText,\n    placeholder: placeholder,\n    errorText: errorText,\n    loadingText: loadingText,\n    enteredTextLabel: enteredTextLabel,\n    onChange: function (_a) {\n      var detail = _a.detail;\n      return onChange(detail.value, row);\n    },\n    onBlur: function () {\n      return onBlur === null || onBlur === void 0 ? void 0 : onBlur(row);\n    },\n    onFocus: function () {\n      onLoadItems('');\n    },\n    onLoadItems: function (_a) {\n      var detail = _a.detail;\n      onLoadItems(detail.filteringText);\n    }\n  });\n});\nexport var UndoButton = React.forwardRef(function (_a, ref) {\n  var children = _a.children,\n    onClick = _a.onClick;\n  var focusVisible = useFocusVisible();\n  return React.createElement(\"a\", __assign({}, focusVisible, {\n    ref: ref,\n    role: \"button\",\n    tabIndex: 0,\n    className: styles['undo-button'],\n    onClick: onClick,\n    onKeyDown: function (event) {\n      if (event.keyCode === KeyCode.space || event.keyCode === KeyCode.enter) {\n        event.preventDefault();\n      }\n      // Enter activates the button on key down instead of key up.\n      if (event.keyCode === KeyCode.enter) {\n        onClick();\n      }\n    },\n    onKeyUp: function (event) {\n      // Emulate button behavior, which also fires on space.\n      if (event.keyCode === KeyCode.space) {\n        onClick();\n      }\n    }\n  }), children);\n});","map":{"version":3,"mappings":"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","names":["React","useEffect","useRef","useState","InternalAutosuggest","useFocusVisible","KeyCode","makeCancellable","PromiseCancelledSignal","styles","TagControl","forwardRef","_a","ref","row","value","readOnly","defaultOptions","placeholder","errorText","loadingText","suggestionText","tooManySuggestionText","limit","filteringKey","enteredTextLabel","onChange","onBlur","onRequest","initialOptionsRef","options","setOptions","statusType","setStatusType","requestCancelFnRef","cancel","isCancelled","latestFilteringQuery","key","undefined","isSameQuery","current","onLoadItems","filteringText","length","promise","then","newOptions","newValues","map","err","empty","detail","onFocus","UndoButton","children","onClick","focusVisible","role","tabIndex","className","onKeyDown","event","keyCode","space","enter","preventDefault","onKeyUp"],"sources":["/Users/dcastro/node_modules/src/tag-editor/internal.tsx"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useEffect, useRef, useState } from 'react';\n\nimport { AutosuggestProps } from '../autosuggest/interfaces';\nimport InternalAutosuggest from '../autosuggest/internal';\nimport { InputProps } from '../input/interfaces';\nimport { DropdownStatusProps } from '../internal/components/dropdown-status';\n\nimport useFocusVisible from '../internal/hooks/focus-visible';\nimport { KeyCode } from '../internal/keycode';\nimport { makeCancellable, PromiseCancelledSignal } from '../internal/utils/promises';\n\nimport styles from './styles.css.js';\n\ninterface FilteringParams {\n  key?: string;\n  value?: string;\n}\nexport interface TagControlProps {\n  row: number;\n  value: string;\n  readOnly: boolean;\n  defaultOptions: AutosuggestProps.Options;\n  placeholder: string;\n  errorText: string;\n  loadingText: string;\n  suggestionText: string;\n  tooManySuggestionText: string;\n  limit: number;\n  filteringKey?: string;\n  enteredTextLabel: (value: string) => string;\n  onChange: (value: string, row: number) => void;\n  onBlur?: (row: number) => void;\n  onRequest?: (value: string) => Promise<readonly string[]>;\n\n  initialOptionsRef?: React.MutableRefObject<AutosuggestProps.Options>;\n}\n\nexport const TagControl = React.forwardRef(\n  (\n    {\n      row,\n      value,\n      readOnly,\n      defaultOptions,\n      placeholder,\n      errorText,\n      loadingText,\n      suggestionText,\n      tooManySuggestionText,\n      limit,\n      filteringKey,\n      enteredTextLabel,\n      onChange,\n      onBlur,\n      onRequest,\n      initialOptionsRef,\n    }: TagControlProps,\n    ref: React.Ref<InputProps.Ref>\n  ) => {\n    const [options, setOptions] = useState<AutosuggestProps.Options>(defaultOptions);\n    const [statusType, setStatusType] = useState<DropdownStatusProps.StatusType>();\n    const requestCancelFnRef = useRef<{ cancel: () => void; isCancelled: () => boolean }>({\n      cancel: () => {},\n      isCancelled: () => false,\n    });\n    const latestFilteringQuery = useRef<FilteringParams>({ key: undefined, value: undefined });\n    const isSameQuery = (key: string | undefined, value: string) =>\n      latestFilteringQuery.current.key === key && latestFilteringQuery.current.value === value;\n\n    // Cancel any active promises on unmount.\n    useEffect(() => () => requestCancelFnRef.current.cancel(), []);\n\n    const onLoadItems = (filteringText: string) => {\n      if (!onRequest || isSameQuery(filteringKey, filteringText) || requestCancelFnRef.current.isCancelled()) {\n        return;\n      }\n      requestCancelFnRef.current.cancel();\n\n      if (filteringText === '' && initialOptionsRef?.current && initialOptionsRef.current.length > 0) {\n        // Load in the background, if the value is empty and we already have suggestions.\n        setOptions(initialOptionsRef.current);\n      }\n      if (latestFilteringQuery.current.key !== filteringKey) {\n        setOptions([]);\n      }\n      setStatusType('loading');\n\n      latestFilteringQuery.current = { key: filteringKey, value: filteringText };\n\n      const { promise, cancel, isCancelled } = makeCancellable(onRequest(filteringText));\n      promise\n        .then(newValues => {\n          const newOptions = newValues.map(value => ({ value }));\n          setStatusType(undefined);\n          setOptions(newOptions);\n          if (initialOptionsRef) {\n            initialOptionsRef.current = newOptions;\n          }\n        })\n        .catch(err => {\n          if (!(err instanceof PromiseCancelledSignal)) {\n            setStatusType('error');\n          }\n        });\n      requestCancelFnRef.current = { cancel, isCancelled };\n    };\n\n    return (\n      <InternalAutosuggest\n        ref={ref}\n        value={value}\n        readOnly={readOnly}\n        statusType={statusType}\n        options={options.length < limit ? options : []}\n        empty={options.length < limit ? suggestionText : tooManySuggestionText}\n        placeholder={placeholder}\n        errorText={errorText}\n        loadingText={loadingText}\n        enteredTextLabel={enteredTextLabel}\n        onChange={({ detail }) => onChange(detail.value, row)}\n        onBlur={() => onBlur?.(row)}\n        onFocus={() => {\n          onLoadItems('');\n        }}\n        onLoadItems={({ detail }) => {\n          onLoadItems(detail.filteringText);\n        }}\n      />\n    );\n  }\n);\n\nexport interface UndoButtonProps {\n  children: React.ReactNode;\n  onClick: () => void;\n}\n\nexport const UndoButton = React.forwardRef(\n  ({ children, onClick }: UndoButtonProps, ref: React.Ref<HTMLAnchorElement>) => {\n    const focusVisible = useFocusVisible();\n\n    return (\n      <a\n        {...focusVisible}\n        ref={ref}\n        role=\"button\"\n        tabIndex={0}\n        className={styles['undo-button']}\n        onClick={onClick}\n        onKeyDown={event => {\n          if (event.keyCode === KeyCode.space || event.keyCode === KeyCode.enter) {\n            event.preventDefault();\n          }\n          // Enter activates the button on key down instead of key up.\n          if (event.keyCode === KeyCode.enter) {\n            onClick();\n          }\n        }}\n        onKeyUp={event => {\n          // Emulate button behavior, which also fires on space.\n          if (event.keyCode === KeyCode.space) {\n            onClick();\n          }\n        }}\n      >\n        {children}\n      </a>\n    );\n  }\n);\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}